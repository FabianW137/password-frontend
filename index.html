<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Password Vault</title>
  <meta name="description" content="Sicherer Passwort-Manager – Login mit TOTP, Tresor mit Suchen, Hinzufügen, Bearbeiten, Löschen.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <svg aria-hidden="true" class="logo" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7v2H3a1 1 0 0 0-1 1v8a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-8a1 1 0 0 0-1-1h-2V9a7 7 0 0 0-7-7Zm0 2a5 5 0 0 1 5 5v2H7V9a5 5 0 0 1 5-5Zm-7 9h14v7H5v-7Z"/></svg>
      <span>Password Vault</span>
    </div>
    <div class="top-actions">
      <button id="btn-logout" class="btn ghost" title="Abmelden" hidden>Abmelden</button>
    </div>
  </header>

  <main class="container">

    <!-- Auth Section -->
    <section id="auth-section" class="card auth">
      <div class="tabs" role="tablist" aria-label="Authentifizierung">
        <button class="tab active" data-tab="login" id="tab-login" role="tab" aria-selected="true" aria-controls="panel-login">Anmelden</button>
        <button class="tab" data-tab="register" id="tab-register" role="tab" aria-selected="false" aria-controls="panel-register">Registrieren</button>
      </div>

      <div id="panel-login" class="tab-panel active" role="tabpanel" aria-labelledby="tab-login">
        <form id="form-login" class="grid form" autocomplete="on">
          <label class="field">
            <span>E-Mail</span>
            <input type="email" id="login-email" required autocomplete="username" placeholder="du@example.com">
          </label>
          <label class="field">
            <span>Passwort</span>
            <input type="password" id="login-password" required autocomplete="current-password" placeholder="••••••••">
          </label>
          <button class="btn primary" type="submit">Anmelden</button>
        </form>
      </div>

      <div id="panel-register" class="tab-panel" role="tabpanel" aria-labelledby="tab-register" hidden>
        <form id="form-register" class="grid form" autocomplete="on">
          <label class="field">
            <span>E-Mail</span>
            <input type="email" id="reg-email" required placeholder="du@example.com">
          </label>
          <label class="field">
            <span>Passwort</span>
            <input type="password" id="reg-password" required placeholder="Mind. 8 Zeichen">
          </label>
          <label class="field">
            <span>Passwort wiederholen</span>
            <input type="password" id="reg-password2" required placeholder="Wiederholen">
          </label>
          <button class="btn primary" type="submit">Konto erstellen</button>
          <p class="hint">Nach der Registrierung bitte mit Ihren Zugangsdaten anmelden und TOTP-Code eingeben.</p>
        </form>
      </div>
    </section>

    <!-- Vault Section (visible after login) -->
    <section id="vault-section" class="vault-layout" hidden>
      <aside class="side">
        <div class="card">
          <h2>Neuer Eintrag</h2>
          <form id="form-create" class="grid form">
            <label class="field"><span>Titel</span><input id="new-title" required placeholder="z.B. GitHub"></label>
            <label class="field"><span>Benutzername</span><input id="new-username" required placeholder="user123"></label>
            <label class="field"><span>Passwort</span><div class="password-wrap"><input id="new-password" type="password" required placeholder="••••••••"><button type="button" class="icon-btn" data-action="gen-pass" title="Passwort generieren">🎲</button></div></label>
            <label class="field"><span>URL</span><input id="new-url" type="url" placeholder="https://..."></label>
            <label class="field"><span>Notizen</span><textarea id="new-notes" rows="3" placeholder="optional"></textarea></label>
            <button class="btn primary" type="submit">Speichern</button>
          </form>
        </div>

        <div class="card">
          <h2>Suche &amp; Filter</h2>
          <input id="search" class="search" placeholder="Suchen… (Titel, User, URL)">
        </div>
      </aside>

      <section class="content">
        <div class="toolbar card">
          <div class="left">
            <h2>Meine Passwörter</h2>
          </div>
          <div class="right smallmuted">
            Backend: <code>https://password-backend-fc0k.onrender.com</code>
          </div>
        </div>

        <div id="vault-list" class="list"></div>

        <template id="tpl-item">
          <div class="item card" data-id="">
            <div class="row">
              <div class="grow">
                <div class="title"></div>
                <div class="muted meta"></div>
              </div>
              <div class="actions">
                <button class="icon-btn" data-action="copy-user" title="Benutzername kopieren">👤</button>
                <button class="icon-btn" data-action="toggle-pass" title="Passwort anzeigen/verbergen">👁️</button>
                <button class="icon-btn" data-action="copy-pass" title="Passwort kopieren">🔑</button>
                <button class="icon-btn" data-action="open-url" title="Seite öffnen">🌐</button>
                <button class="icon-btn danger" data-action="delete" title="Löschen">🗑️</button>
              </div>
            </div>
            <div class="grid form compact edit-fields" hidden>
              <label class="field"><span>Titel</span><input class="e-title"></label>
              <label class="field"><span>Benutzername</span><input class="e-username"></label>
              <label class="field"><span>Passwort</span><div class="password-wrap"><input class="e-password" type="password"><button type="button" class="icon-btn" data-action="gen-pass-row" title="Passwort generieren">🎲</button></div></label>
              <label class="field"><span>URL</span><input class="e-url" type="url"></label>
              <label class="field"><span>Notizen</span><textarea class="e-notes" rows="2"></textarea></label>
              <div class="edit-actions">
                <button class="btn" data-action="cancel-edit">Abbrechen</button>
                <button class="btn primary" data-action="save-edit">Speichern</button>
              </div>
            </div>
            <div class="details">
              <div class="kv"><span class="k">Benutzername</span><span class="v user"></span></div>
              <div class="kv"><span class="k">Passwort</span><span class="v pass masked" data-mask="••••••••"></span></div>
              <div class="kv"><span class="k">URL</span><span class="v url"></span></div>
              <div class="kv"><span class="k">Notizen</span><span class="v notes"></span></div>
            </div>
          </div>
        </template>
      </section>
    </section>
  </main>

  <!-- TOTP Modal -->
  <div id="totp-modal" class="modal" aria-hidden="true" hidden>
    <div class="modal-box card">
      <h3>Zwei‑Faktor-Code</h3>
      <p>Bitte geben Sie Ihren 6‑stelligen TOTP‑Code aus der Authenticator‑App ein.</p>
      <form id="form-totp" class="row form-inline">
        <input id="totp-code" inputmode="numeric" pattern="\d*" minlength="6" maxlength="6" placeholder="123456" required>
        <button class="btn primary" type="submit">Bestätigen</button>
      </form>
      <button class="btn ghost mt" data-action="cancel-totp">Abbrechen</button>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>
  
  <noscript>Diese Anwendung benötigt JavaScript.</noscript>
</body>
</html>
